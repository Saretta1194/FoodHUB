{% extends "base.html" %}
{% block content %}
<section class="form-page">
  <div class="card form-card">
    <div class="card-body p-4 p-md-5">
      <h1 class="h4 mb-3">Your cart</h1>

      {% if items %}
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Dish</th>
                <th class="text-end">Unit price</th>
                <th class="text-center" style="width:160px;">Quantity</th>
                <th class="text-end">Line total</th>
                <th class="text-end" style="width:140px;"></th>
              </tr>
            </thead>
            <tbody>
              {% for it in items %}
                <tr>
                  <td>
                    <strong>{{ it.dish.name }}</strong>
                  </td>
                  <td class="text-end">€ {{ it.dish.price|floatformat:2 }}</td>

                  {# Update quantity: reuse cart_add with new qty #}
                  <td>
                    <form method="post" action="{% url 'orders:cart_add' it.dish.id %}" class="d-flex justify-content-center gap-2">
                      {% csrf_token %}
                      <input type="number" name="qty" value="{{ it.quantity }}" min="1" class="form-control form-control-sm" style="width:80px;">
                      <button type="submit" class="btn btn-sm btn-outline-primary">Update</button>
                    </form>
                  </td>

                  <td class="text-end">€ {{ it.line_total|floatformat:2 }}</td>

                  {# Remove item #}
                  <td class="text-end">
                    <form method="post" action="{% url 'orders:cart_remove' it.dish.id %}">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-outline-danger">Remove</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr>
                <th colspan="3" class="text-end">Total</th>
                <th class="text-end">€ {{ total|floatformat:2 }}</th>
                <th></th>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="d-flex justify-content-between mt-3">
          <a href="{% url 'restaurants:public_list' %}" class="btn btn-outline-secondary">Continue shopping</a>
          <a href="{% url 'orders:checkout' %}" class="btn btn-primary">Go to checkout</a>
        </div>
      {% else %}
        <div class="alert alert-info">Your cart is empty.</div>
        <a href="{% url 'restaurants:public_list' %}" class="btn btn-primary">Browse restaurants</a>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
